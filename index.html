<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBC Wholesale Portal</title>
    <style>
        :root { --blue: #007bff; --dark: #1a1a1a; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; color: #333; }
        .site-header { background: var(--dark); color: white; padding: 15px 5%; display: flex; align-items: center; justify-content: space-between; border-bottom: 4px solid var(--blue); }
        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; }
        
        /* SEARCH BOX & DROPDOWN */
        .search-container { position: relative; width: 100%; max-width: 600px; margin: 20px auto; }
        #search-input { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1.1em; outline: none; }
        #search-input:focus { border-color: var(--blue); }
        
        .dropdown { 
            position: absolute; width: 100%; background: white; border: 1px solid #ccc; 
            border-radius: 0 0 8px 8px; z-index: 10000; display: none; 
            max-height: 300px; overflow-y: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            top: 100%; left: 0;
        }
        .dropdown-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; text-align: left; }
        .dropdown-item:hover { background: #f0f7ff; }
        .dropdown-item strong { color: var(--blue); }

        /* REVIEW PAGE */
        .review-header { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .client-block { font-size: 1.1em; line-height: 1.4; }
        .btn { padding: 15px 25px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-primary { background: var(--blue); color: white; }
    </style>
</head>
<body>

<header class="site-header">
    <div style="display:flex; align-items:center; gap:15px;">
        <img src="https://raw.githubusercontent.com/remyjdavis/brewery-order-form/main/logo.png" height="50" style="background:white; padding:3px; border-radius:4px;">
        <h2 style="margin:0;">Suburban Brewing Co.</h2>
    </div>
</header>

<div class="container" id="app"></div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyT1PzljxVZ9NKBbgmAJ7kgPul228vnwrdjf_YRbzhIMR_rXhG2tx36-yzBHfFNH5DX/exec";
    let state = { step: 0, customer: null, cart: [] };

    function render() {
        const app = document.getElementById("app");
        app.innerHTML = "";

        if (state.step === 0) {
            app.innerHTML = `
                <div class="card">
                    <h2>Wholesale Agreement</h2>
                    <div style="height:250px; overflow-y:scroll; border:1px solid #eee; padding:15px; background:#fafafa; font-size:0.9em; margin-bottom:20px;">
                        <p><strong>Terms:</strong> Payment is Net-on-Delivery. All products must be refrigerated at 38Â°F. Kegs remain property of SBC ($30 deposit applies).</p>
                    </div>
                    <label style="display:block; margin-bottom:20px; cursor:pointer;">
                        <input type="checkbox" id="agree"> I agree to the wholesale terms and conditions.
                    </label>
                    <button class="btn btn-primary" onclick="if(document.getElementById('agree').checked){state.step=1;render()}">Agree & Proceed</button>
                </div>`;
        } else if (state.step === 1) {
            app.innerHTML = `
                <div class="card" style="text-align:center;">
                    <h2>Find Your Account</h2>
                    <div class="search-container">
                        <input type="text" id="search-input" placeholder="Start typing business name..." autocomplete="off">
                        <div id="results" class="dropdown"></div>
                    </div>
                </div>`;
            document.getElementById("search-input").oninput = (e) => doSearch(e.target.value);
        } else if (state.step === 3) {
            app.innerHTML = `
                <div class="card">
                    <div class="review-header">
                        <div class="client-block">
                            <div style="color:var(--blue); font-weight:bold; margin-bottom:10px;">Suburban Brewing Co.</div>
                            <div style="font-weight:900; font-size:1.3em;">${state.customer.name}</div>
                            <div>${state.customer.address}</div>
                            <div>${state.customer.city}, ${state.customer.state} ${state.customer.zip}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="color:#666; font-size:0.8em;">DATE</div>
                            <div style="font-weight:bold;">${new Date().toLocaleDateString()}</div>
                        </div>
                    </div>
                    <hr>
                    <p style="text-align:center; padding:20px; color:#666;">[Product Table Goes Here]</p>
                    <button class="btn btn-primary" style="background:#28a745;">Submit Final Order</button>
                </div>`;
        }
    }

    async function doSearch(val) {
        if (val.length < 2) return;
        const res = await fetch(`${API_URL}?q=${encodeURIComponent(val)}`);
        const data = await res.json();
        const box = document.getElementById("results");
        
        if (data.results && data.results.length > 0) {
            box.style.display = "block";
            box.innerHTML = data.results.map(c => `
                <div class="dropdown-item" onclick='selectCust(${JSON.stringify(c).replace(/'/g, "&apos;")})'>
                    <strong>${c.name}</strong><br><small>${c.address}, ${c.city}</small>
                </div>
            `).join("");
        } else {
            box.style.display = "none";
        }
    }

    window.selectCust = (c) => { state.customer = c; state.step = 3; render(); };

    render();
</script>
</body>
</html>
