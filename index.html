<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBC Wholesale</title>
    <style>
        :root { --sbc-blue: #007bff; --sbc-dark: #1a1a1a; }
        body { font-family: -apple-system, sans-serif; background: #f4f7f9; margin: 0; padding-bottom: 100px; }
        .site-header { background: white; padding: 25px; border-bottom: 5px solid var(--sbc-dark); display: flex; align-items: center; gap: 20px; }
        .site-header img { height: 75px; }
        .container { max-width: 800px; margin: 30px auto; padding: 0 15px; }
        .card { background: white; padding: 30px; border-radius: 8px; border: 1px solid #ddd; }
        
        /* THE LONG SEARCH BAR */
        .search-input { 
            width: 100%; 
            padding: 18px; 
            font-size: 1.25em; 
            border: 2px solid #ccc; 
            border-radius: 8px; 
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        .search-input:focus { border-color: var(--sbc-blue); outline: none; }
        
        #results { background: white; border-radius: 8px; border: 1px solid #eee; margin-top: 5px; overflow: hidden; }
        .result-item { padding: 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: 0.2s; }
        .result-item:hover { background: #f8f9fa; color: var(--sbc-blue); }

        .btn { padding: 15px 25px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn-success { background: #28a745; color: white; font-size: 1.1em; }
        .live-bar { position: fixed; bottom: 0; left:0; right:0; background: var(--sbc-dark); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<header class="site-header">
    <img src="https://raw.githubusercontent.com/remyjdavis/brewery-order-form/main/logo.png">
    <div><h1 style="margin:0;">Suburban Brewing Co.</h1><p style="margin:0;">Wholesale Portal</p></div>
</header>

<div class="container" id="app"></div>

<div id="live-bar" class="live-bar" style="display:none;">
    <div style="font-size: 1.2em;">Total: <span id="live-total">$0.00</span></div>
    <button class="btn" style="width: auto; background: var(--sbc-blue); color:white;" onclick="state.step=3;render()">Review Order</button>
</div>

<script>
    const API_URL = "YOUR_APPS_SCRIPT_URL"; // PASTE YOUR WEB APP URL HERE
    let state = { step: 1, customer: null, cart: [] };

    function render() {
        const app = document.getElementById("app");
        document.getElementById("live-bar").style.display = (state.step === 2) ? "flex" : "none";
        app.innerHTML = "";

        if (state.step === 1) {
            app.innerHTML = `
                <div class="card">
                    <h2>Account Search</h2>
                    <input type="text" class="search-input" placeholder="Search by restaurant or business name..." oninput="doSearch(this.value)">
                    <div id="results"></div>
                </div>`;
        } else if (state.step === 2) {
            // Simplified order grid for brevity - add your product map here
            app.innerHTML = `<div class="card"><h3>Ordering for: ${state.customer.name}</h3><p>Product list loading...</p></div>`;
        } else if (state.step === 3) {
            const t = calculate();
            app.innerHTML = `
                <div class="card">
                    <div style="border-bottom:3px solid #111; padding-bottom:10px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                        <strong>Suburban Brewing Co.</strong>
                        <span>${new Date().toLocaleDateString()}</span>
                    </div>
                    <div>
                        <strong>BILL TO:</strong><br>${state.customer.name}<br>${state.customer.address}<br>${state.customer.city}, ${state.customer.state} ${state.customer.zip}
                    </div>
                    <hr>
                    <div style="margin: 20px 0; padding: 15px; background: #eef7ff; border-radius: 8px;">
                        <label style="display:block; cursor:pointer;">
                            <input type="checkbox" id="want-email" onchange="document.getElementById('email-input-wrap').style.display=this.checked?'block':'none'"> 
                            Send a copy of this invoice to my email
                        </label>
                        <div id="email-input-wrap" style="display:none; margin-top:10px;">
                            <input type="email" id="cust-email" class="search-input" style="font-size: 1em; padding:10px;" placeholder="Enter email address...">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="handleFinalSubmit()">Submit Final Order</button>
                </div>`;
        }
    }

    async function doSearch(v) {
        if(v.length < 3) return;
        const res = await fetch(API_URL + "?q=" + v);
        const data = await res.json();
        document.getElementById("results").innerHTML = data.results.map(c => `
            <div class="result-item" onclick='state.customer=${JSON.stringify(c)};state.step=2;render()'>
                <strong>${c.name}</strong><br><small>${c.address}, ${c.city}</small>
            </div>
        `).join("");
    }

    async function handleFinalSubmit() {
        const want = document.getElementById("want-email").checked;
        const email = document.getElementById("cust-email").value;
        if (want && !email) { alert("Please enter an email"); return; }
        
        const btn = event.target;
        btn.innerText = "Processing...";
        btn.disabled = true;

        await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({ ...state, totals: calculate(), recipientEmail: want ? email : null })
        });
        alert("Order Received!");
        location.reload();
    }
    
    function calculate() { /* Your existing math logic */ return { sub: 0, disc: 0, dep: 0, tax: 0, final: 0 }; }
    render();
</script>
</body>
</html>
